
# game-rails

## 概要
このアプリは、既存の日本のボードゲームをオンラインで実現するWebアプリケーションです。ユーザーはログインし、ルームを作成・参加して、他のプレイヤーとリアルタイムでゲームを楽しめます。

## 目的
日本の伝統的・人気ボードゲームを、物理的な距離を超えて複数人で安全に遊べる環境を提供します。

## 主な機能
- ユーザー登録・ログイン・パスワードリセット
- ルーム作成・参加・退出・削除
- ルーム内チャット・ゲーム進行のリアルタイム同期
- お題（ans_themes）の自動出題・管理
- ゲーム履歴・ユーザー情報の管理
- 管理者によるユーザー・ルーム管理

## 画面遷移例
1. トップページ（ログイン/新規登録）
2. ログイン後、ロビー画面（ルーム一覧表示・作成）
3. ルーム入室→ゲーム画面（チャット・お題表示・回答・進行）
4. ゲーム終了→結果表示→ロビーへ戻る

## 利用技術
- フレームワーク: Ruby on Rails 8
- DB: PostgreSQL
- 認証: has_secure_password, bcrypt
- フロント: Turbo, Stimulus, ActionCable
- テスト: RSpec
- CI/CD: GitHub Actions など

## システム構成図（簡易テキスト図）

## 主な特徴
- 日本のボードゲームをオンラインで体験可能
- ユーザー認証（ログイン/パスワード管理）
- ルーム作成・参加機能
- データベースによるセキュアなユーザー・ルーム・ゲーム情報管理
- ActionCableによるリアルタイム通信

## システム構成図（簡易テキスト図）

```
┌────────────┐      ┌────────────┐      ┌────────────┐
│  ユーザーA │◀───▶│  Railsサーバ │◀───▶│  PostgreSQL │
└────────────┘      └────────────┘      └────────────┘
	▲   ▲                ▲   ▲
	│   └─────────┐      │   │
	│             │      │   │
┌────────────┐      │      │   │
│  ユーザーB │◀─────┘      │   │
└────────────┘             │   │
	▲                    │   │
	│                    │   │
┌────────────┐             │   │
│  ユーザーC │◀────────────┘   │
└────────────┘                 │
					 │
	  ┌───────────────┐      │
	  │  ActionCable  │◀─────┘
	  └───────────────┘
```

## データベース設計（例）
- users（ユーザー情報: name, email, password_digest, ...）
- rooms（ルーム情報: room_name, host_id, password, ...）
- ans_themes（お題情報: text, ...）
- sessions（セッション管理）
- join_users（ルーム参加者管理）
- good_ans_games（ゲーム進行・履歴）


## セキュリティ

本アプリは、以下のような多層的なセキュリティ対策を実施しています。

### 1. パスワード管理
- パスワードは平文で保存せず、bcryptによるハッシュ化を行いDBに保存
- パスワードリセット時はトークンを発行し、一定時間のみ有効
- パスワードのバリデーション（長さ・複雑さ）

### 2. 通信の安全性
- 本番環境ではHTTPS（SSL/TLS）を必須化
- CookieのSecure属性、HttpOnly属性を設定

### 3. 認証・認可
- has_secure_passwordによる認証
- ログイン必須ページへの未認証アクセスはリダイレクト
- 管理者権限のチェック（管理画面・操作）

### 4. 脆弱性対策
- CSRF（クロスサイトリクエストフォージェリ）対策：Rails標準のCSRFトークンを利用
- SQLインジェクション対策：ActiveRecordによるプリペアドステートメント
- XSS（クロスサイトスクリプティング）対策：出力時の自動エスケープ
- セッション固定攻撃対策：ログイン時のセッションID再発行

### 5. データ管理
- ユーザー・ルーム・ゲーム情報はDBで厳格に管理
- 不要な個人情報は保存しない
- DBアクセス権限の最小化

### 6. ログ・監査
- 重要操作・エラーのログ記録
- 管理者による監査が可能


## 運用例
1. 管理者が初期お題CSVをインポート
2. ユーザーが登録・ログイン
3. ルームを作成し、他ユーザーを招待
4. ルーム内でゲームを進行（お題出題・回答・判定）
5. 終了後、履歴や成績を確認


## セキュリティ
- パスワードはハッシュ化して保存
- 各種情報はDBで厳格に管理


